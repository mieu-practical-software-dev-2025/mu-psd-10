# 単体テスト仕様書: 要約アプリ

## 1. テスト対象
- `app.py`（Flaskサーバー/APIバックエンド）
- `static/index.html`（Vue.jsフロントエンドUI）

## 2. テスト環境
- OS: Windows 11
- Python: 3.x
- ブラウザ: Google Chrome (最新版)
- 依存ライブラリ: `requirements.txt` に記載
- APIキー: OpenRouter APIキーが`.env`ファイルに設定済みであること

## 3. バックエンド単体テスト (`app.py`)

| No. | テスト分類 | テストケース | 手順 | 期待される結果 | 実行結果 | 判定 |
|:----|:-----------|:-------------|:-----|:-----------------|:-----------|:-----|
| B-1 | サーバー起動 | サーバーが正常に起動する | `python app.py` を実行する。 | エラーなく起動し、`http://localhost:5000` でリッスンする。 | 同左 | ✅ Pass |
| B-2 | 静的ファイル配信 | ルートURLへのアクセス | ブラウザで `http://localhost:5000/` にアクセスする。 | `index.html` の内容が表示される。 | 同左 | ✅ Pass |
| B-3 | API正常系 (テキスト) | 正常なテキスト要約リクエスト | `{"text": "これはテストです", "context": "テスト用"}` を `/send_api` にPOSTする。 | ステータスコード200と、AIからの要約を含むJSONが返る。 | 同左 | ✅ Pass |
| B-4 | API正常系 (URL) | 正常なURL要約リクエスト | `{"url": "[存在する記事のURL]", "context": "テスト用"}` を `/send_api` にPOSTする。 | ステータスコード200と、AIからの要約を含むJSONが返る。 | 同左 | ✅ Pass |
| B-5 | API正常系 (デバッグ) | デバッグモック機能 | `{"text": "DEBUG_MOCK"}` を `/send_api` にPOSTする。 | ステータスコード200と、固定のモック応答JSONが返る。 | 同左 | ✅ Pass |
| B-6 | API異常系 (入力) | text/urlフィールドが空 | `{"text": " ", "url": " "}` を `/send_api` にPOSTする。 | ステータスコード400と、エラーメッセージ「要約するテキストまたはURLを入力してください。」が返る。 | 同左 | ✅ Pass |
| B-7 | API異常系 (入力) | text/urlフィールド欠損 | `{}` を `/send_api` にPOSTする。 | ステータスコード400と、エラーメッセージ「要約するテキストまたはURLを入力してください。」が返る。 | 同左 | ✅ Pass |
| B-8 | API異常系 (URL) | 存在しないURL | `{"url": "[存在しないURL]"}` を `/send_api` にPOSTする。 | ステータスコード500と、エラーメッセージ「URLの処理中に予期せぬエラーが発生しました。」が返る。 | 同左 | ✅ Pass |
| B-9 | API異常系 (設定) | APIキー未設定 | `.env` の `OPENROUTER_API_KEY` を空にしてリクエストを送る。 | ステータスコード500と、エラーメッセージ「OpenRouter API key is not configured on the server.」が返る。 | 同左 | ✅ Pass |
| B-10 | API異常系 (制限) | API利用回数制限超過 | (シミュレーション) OpenRouter APIが429エラーを返す。 | ステータスコード429と、エラーメッセージ「APIの利用回数制限に達しました...」が返る。 | 同左 | ✅ Pass |
| B-11 | API異常系 (AI応答) | AIからの応答が空 | (シミュレーション) AIが応答を返すが、choicesが空。 | ステータスコード200と、`processed_text`に「AIから有効な応答がありませんでした。」が含まれるJSONが返る。 | 同左 | ✅ Pass |

---

## 4. フロントエンド単体テスト (`static/index.html`)

| No. | テスト分類 | テストケース | 手順 | 期待される結果 | 実行結果 | 判定 |
|:----|:-----------|:-------------|:-----|:-----------------|:-----------|:-----|
| F-1 | 初期表示 | 画面の初期状態 | ページをリロードする。 | 1. 各設定がデフォルト値である。<br>2. 結果表示エリアに初期メッセージが表示される。<br>3. 「要約を実行」ボタンが有効である。 | 同左 | ✅ Pass |
| F-2 | 入力検証 | テキスト入力が空で実行 | 「テキスト入力」タブで、入力欄を空にして「要約を実行」ボタンを押す。 | 結果エリアに「エラー: 要約するテキストを入力してください。」と表示される。 | 同左 | ✅ Pass |
| F-3 | 入力検証 | URL入力が空で実行 | 「URL入力」タブで、入力欄を空にして「要約を実行」ボタンを押す。 | 結果エリアに「エラー: 要約するURLを入力してください。」と表示される。 | 同左 | ✅ Pass |
| F-4 | 入力検証 | 不正な形式のURLで実行 | 「URL入力」タブで、`example.com` のように入力して「要約を実行」ボタンを押す。 | 結果エリアに「エラー: 有効なURL形式で入力してください...」と表示される。 | 同左 | ✅ Pass |
| F-5 | API連携 | 正常な要約実行 | テキストを入力し、「要約を実行」ボタンを押す。 | 1. ボタンが「処理中...」となり無効化される。<br>2. API成功後、結果エリアに要約が表示される。<br>3. ボタンが再び有効化される。 | 同左 | ✅ Pass |
| F-6 | API連携 | APIエラー時の表示 | (バックエンドを停止させるなどして)APIリクエストが失敗するようにして実行する。 | 結果エリアに「エラー: サーバーへの接続に失敗しました...」のようなメッセージが表示される。 | 同左 | ✅ Pass |
| F-7 | UI機能 | テーマ切り替え | 右上のテーマ切り替えボタンを押す。 | 1. UIがライト/ダークモードに切り替わる。<br>2. アイコンが太陽/月に切り替わる。<br>3. リロードしても設定が維持される。 | 同左 | ✅ Pass |
| F-8 | UI機能 | 結果のコピー | 正常な要約結果が表示された状態で「コピー」ボタンを押す。 | 1. 「クリップボードにコピーしました」というトースト通知が表示される。<br>2. クリップボードに結果がコピーされている。 | 同左 | ✅ Pass |
| F-9 | UI機能 | URL入力クリアボタン | URL入力欄に文字を入力する。 | 1. 入力欄の右に「×」ボタンが表示される。<br>2. 「×」ボタンを押すと入力欄が空になる。 | 同左 | ✅ Pass |
| F-10 | 履歴機能 | 履歴の保存 | 正常な要約を実行する。 | 1. 実行内容が履歴に追加される。<br>2. 「履歴」モーダルを開くと、追加した項目が表示される。 | 同左 | ✅ Pass |
| F-11 | 履歴機能 | 履歴の復元 | 「履歴」モーダルで、任意の項目の「復元」ボタンを押す。 | 1. モーダルが閉じる。<br>2. 当時の入力内容、設定、結果が画面に復元される。 | 同左 | ✅ Pass |
| F-12 | 履歴機能 | 履歴の削除（個別） | 「履歴」モーダルで、任意の項目の「削除」ボタンを押す。 | 選択した項目がリストから削除される。 | 同左 | ✅ Pass |
| F-13 | 履歴機能 | 履歴の削除（全件） | 「履歴」モーダルで、「全履歴を削除」ボタンを押し、確認ダイアログでOKする。 | すべての履歴がリストから削除される。 | 同左 | ✅ Pass |

---
