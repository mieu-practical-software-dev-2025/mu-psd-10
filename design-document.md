# Webアプリ仕様書: 要約アプリ

## 1. 概要

ユーザーが入力したテキスト、または指定したURLのWebページ本文を、選択された形式と長さで要約するWebアプリケーション。ダークモード切り替えや、処理中の状態表示など、モダンなUI/UX機能も備える。

## 2. 主な機能

### 2.1 ユーザーインターフェース (UI)
- **入力方法選択**: タブUIにより「テキスト入力」と「URL入力」を切り替える。
- **出力形式選択**: ラジオボタンで「文章で要約」または「箇条書きで要約」を選択する。
- **要約の長さ選択**: ラジオボタンで「短く」「普通」「詳しく」を選択する。
- **実行**: 「要約を実行」ボタンで要約を開始する。処理中はボタンが無効化され、スピナーが表示される。
- **結果表示**:
    - 要約結果、処理中のステータス、またはエラーメッセージを表示する。
    - 要約結果の文字数をリアルタイムで表示する。
    - 「コピー」ボタンで結果をクリップボードにコピーできる。
- **UI/UX改善**:
    - **ダークモード**: ユーザーのシステム設定に応じて初期テーマを決定し、手動での切り替えも可能。設定はブラウザに保存される。
    - **トースト通知**: 「コピーしました」などのフィードバックを画面右下のポップアップで通知する。

### 2.2 バックエンドAPI (`/send_api`)
- **入力処理**:
    - リクエストボディの`text`または`url`フィールドを受け付ける。
    - `url`が指定された場合、`newspaper3k`ライブラリを用いてWebページから記事本文をインテリジェントに抽出する。
- **コンテキスト生成**: ユーザーが選択した出力形式と要約の長さに応じて、AIへの指示（システムプロンプト）を動的に生成する。「余計な挨拶文を含めない」といった指示も付与する。
- **AI連携**: 抽出または入力された本文と生成したコンテキストを組み合わせ、OpenRouter経由でLLMへリクエストを送信する。
- **開発者向け機能**:
    - **モックモード**: `text`フィールドに`DEBUG_MOCK`と入力すると、APIを消費せずに固定のダミー応答を返し、フロントエンド開発を支援する。

### 2.3 エラーハンドリング
- **フロントエンド**:
    - 入力が空の場合にエラーを表示する。
    - URLの形式が不正な場合（`http://`または`https://`で始まらない）にエラーを表示する。
- **バックエンド**:
    - APIキー未設定、記事本文の抽出失敗、API利用回数制限超過(`RateLimitError`)などのエラーを検知し、それぞれに応じた適切なエラーメッセージとステータスコードを返す。

## 3. 使用技術

| 分類         | 技術・ライブラリ |
|--------------|------------------|
| フロントエンド | Vue.js 3 / HTML5 + CSS3 / Bootstrap 5.3+ |
| バックエンド  | Flask / newspaper3k / NLTK |
| 通信方式     | Fetch API / JSON |
| LLMモデル    | OpenRouter API（google/gemma-3-27b-it:free 等） |

## 4. 入出力例

### 入力例1 (テキスト入力)
- **ユーザー入力（テキストタブ）**: `本日、気象庁は今年の夏の天候予測を発表しました。それによると、太平洋高気圧の勢力が例年よりも強まる影響で、全国的に猛暑となる見込みです。特に西日本では気温が平年を大幅に上回る日が多くなると予測されており、熱中症への厳重な警戒が呼びかけられています。また、降水量は平年並みか少なくなる傾向ですが、局地的な大雨のリスクも指摘されています。`
- **ユーザー選択**:
  - 出力形式: `文章で要約`
  - 要約の長さ: `短く (3行程度)`
- **生成されるコンテキスト**: `あなたは優秀な編集者です。以下の文章を、最も重要な点に絞って3行程度で要約してください。要約文のみを出力し、前後の説明文は一切含めないでください。`
- **出力例**: `気象庁は今夏の天候予測を発表し、全国的な猛暑を予測しています。特に西日本では平年を大幅に上回る気温が予想され、熱中症への厳重な警戒が必要です。降水量は平年並みか少ないものの、局地的な大雨にも注意が求められます。`

### 入力例2 (URL入力)
- **ユーザー入力（URLタブ）**: `[ニュース記事のURL]`
- **ユーザー選択**:
  - 出力形式: `箇条書きで要約`
  - 要約の長さ: `普通`
- **生成されるコンテキスト**: `あなたは優秀な編集者です。以下の文章を、簡潔に箇条書きでまとめてください。箇条書きのリストのみを出力し、前後の説明文は一切含めないでください。`
- **出力例**:
  - `全国的に猛暑となる見込み。`
  - `特に西日本では気温が平年を大幅に上回り、熱中症への厳重な警戒が必要。`
  - `降水量は平年並みか少ないが、局地的な大雨の可能性もある。`